server {

	listen 80 default;
        root /usr/share/webapps;
        
	include /etc/nginx/fpm.conf;
 
	fastcgi_buffers 64 4K;
        error_page   500 502 503 504  /50x.html;                                                                                      
	location = /50x.html {
		root   /usr/share/nginx/html;
	}
                                                                                                                                      
        location / {
                index index.php index.xhtml index.html;
        	rewrite "^.*$" /HUMHUB_SUBDIR break;
	}
                                                                                                                                      
        location ~* \.(?:ico|css|js|gif|jpe?g|png|ttf|woff)$ {                                                                        
                access_log off;                                                                                                       
                expires 30d;                                                                                                          
                add_header Pragma public;                                                                                             
                add_header Cache-Control "public, mustrevalidate, proxy-revalidate";                                                  
        }                                                                                                                             
                                                                                                                                      
        location /HUMHUB_SUBDIR {
                try_files $uri $uri/ /HUMHUB_SUBDIR/index.php?$args;
        }                                                                                                                             
                                                                                                                                      
        location ~ /HUMHUB_SUBDIR/\.ht {                                                                                                        
                deny all;                                                                                                             
        }                                                                                                                             
                                                                                                                                      
        location /HUMHUB_SUBDIR/protected {                                                                                                     
                deny all;                                                                                                             
        }                                                                                                                             
                                                                                                                                      
        location /HUMHUB_SUBDIR/uploads/file {                                                                                                  
                deny all;                                                                                                             
        }                                                                                                                             
                                                                                                                                      
        location = /robots.txt {                                                                                                      
            allow all;                                                                                                                
            log_not_found off;                                                                                                        
            access_log off;                                                                                                           
        }                                                                                                                             
                                                                                                                                      
        location ~ ^/(?:\.htaccess|data|config|db_structure\.xml|README) {                                                            
            deny all;                                                                                                                 
        }                                                                                                                             
                                                                                                                                      
        location ~ /\. {deny all; access_log off; log_not_found off;}                                                                 
                                                                                                                                      
                                                                                                                                      
        ## Optional: set long EXPIRES header on static assets                                                                         
        location ~* \.(?:jpg|jpeg|gif|bmp|ico|png|css|js|swf)$ {                                                                      
            expires 30d;                                                                                                              
            ## Optional: Don't log access to assets                                                                                   
            access_log off;                                                                                                           
        }                                                                                                                             
}   
