version: '2'

services:
  redis:
    restart: always
    container_name: moodle_redis
    hostname: redis
    image: maxder/alpine-redis:x86_64
  mariadb:
    restart: always
    container_name: moodle_db
    hostname: mariadb
    image: maxder/alpine-mariadb:x86_64
    volumes:
    - /srv/docker/moodle/db:/var/lib/mysql
    environment:
    - DBUSER=dbadmin
    - DBPASS=dbadminpass
  moodle:
    restart: always
    container_name: moodle
    hostname: moodle
    image: maxder/debian-moodle:x86_64
    ports:
    - 10083:80
    - 10443:443
    volumes:
    - /srv/docker/moodle/data:/moodledata
    - /srv/docker/moodle/apache/tls:/etc/apache2/tls
    - /srv/docker/moodle/apache/sites-enabled:/etc/apache2/sites-enabled
    environment:
    - DBUSER=dbadmin
    - DBPASS=dbadminpass
    - SUBDIR=lms 			## Maps Moodle to subdir
    - WWWROOT=https://localhost		## Your domain or IP address here
    #- INSTALL=silent 			## Silent installation via CLI
    #- APPADMINPASS=adminpass 		## Admin password for silent installation
    #- APPADMIN=admin 			## Admin username for silent installation
    #- APPADMINEMAIL=admin@domain.org	## Admin email for silent installation
    depends_on:
    - mariadb
    - redis
    links:
    - mariadb:db
    - redis:redis
