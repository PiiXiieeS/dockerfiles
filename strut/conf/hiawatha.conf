# Hiawatha main configuration file

# GENERAL SETTINGS
ServerId = www-data
ConnectionsTotal = 1000
ConnectionsPerIP = 35
SystemLogfile = /var/log/hiawatha/system.log
GarbageLogfile = /var/log/hiawatha/garbage.log
ExploitLogfile = /var/log/hiawatha/exploit.log

LogFormat = extended
ServerString = SimpleHTTPserver
CGIwrapper = /usr/sbin/cgi-wrapper

# BINDING SETTINGS
Binding {
	Port = 80
	MaxKeepAlive = 50
	TimeForRequest = 12,50
}
#
#Binding {
#	Port = 443
#	Interface = ::1
#	MaxKeepAlive = 30
#	TimeForRequest = 3,20
#	TLScertFile = hiawatha.pem
#}


# BANNING SETTINGS
BanOnMaxPerIP = 300
BanOnMaxReqSize = 300
BanOnTimeout = 300
KickOnBan = yes
RebanDuringBan = yes
 
BanOnDeniedBody = 300
BanOnSQLi = 300
BanOnFlooding = 90/1:300
BanlistMask = deny 127.0.0.1
BanOnInvalidURL = 300
 
BanOnWrongPassword = 3:300
ChallengeClient = 70,httpheader,300

#SETTINGS
CGIhandler = /usr/bin/perl:pl
CGIhandler = /usr/sbin/php5-fpm:php
CGIhandler = /usr/bin/python:py
CGIhandler = /usr/bin/ruby:rb
CGIhandler = /usr/bin/ssi-cgi:shtml
CGIextension = cgi

FastCGIserver {
        FastCGIid = PHP5
#       ConnectTo = 127.0.0.1:9000
        ConnectTo = /var/run/php5-fpm.sock
        Extension = php
        SessionTimeout = 600
}

# URL TOOLKIT
UrlToolkit {
        ToolkitID = banshee
        Do Call scannerblocker
        Do Call vulnerabilityblocker
        RequestURI isfile Return
        Match ^/(css|files|images|js|slimstat)($|/) Return
        Match ^/(favicon.ico|robots.txt|sitemap.xml)$ Return
        Match ^/(crawler)($|/) Return
        Match .*\?(.*) Rewrite /index.php?$1
        Match .* Rewrite /index.php
}

UrlToolkit {
        ToolkitID = vulnerabilityblocker
        Header * \(\)\s*\{ DenyAccess   # Shellshock
        MatchCI ^/(crawler|pma|myadmin|phpmyadmin|cgi-bin)($|/) Ban 900 # phpmyadmin & cgi-bin
        MatchCI ^/(xmlrpc.php|phpinfo.php)$ Ban 900 # wordpress, drupal & phpinfo
}
 
UrlToolkit {
        ToolkitID = scannerblocker
        Header User-Agent ^w3af.sourceforge.net DenyAccess
        Header User-Agent ^dirbuster DenyAccess
        Header User-Agent ^nikto DenyAccess
        Header User-Agent ^sqlmap DenyAccess
        Header User-Agent ^fimap DenyAccess
        Header User-Agent ^nessus DenyAccess
        Header User-Agent ^Nessus DenyAccess
        Header User-Agent ^whatweb DenyAccess
        Header User-Agent ^Openvas DenyAccess
        Header User-Agent ^jbrofuzz DenyAccess
        Header User-Agent ^libwhisker DenyAccess
        Header User-Agent ^webshag DenyAccess
        Header User-Agent ^Morfeus DenyAccess
        Header User-Agent ^Fucking DenyAccess
        Header User-Agent ^Scanner DenyAccess
        Header User-Agent ^Aboundex DenyAccess
        Header User-Agent ^AlphaServer DenyAccess
        Header User-Agent ^Indy DenyAccess
        Header User-Agent ^ZmEu DenyAccess
        Header User-Agent ^social DenyAccess
        Header User-Agent ^Zollard DenyAccess
        Header User-Agent ^CLR DenyAccess
        Header User-Agent ^Camino DenyAccess
        Header User-Agent ^Nmap DenyAccess
        Header * ^WVS DenyAccess
        Header User-Agent ^Python-httplib DenyAccess
        Header User-Agent ^Python-requests DenyAccess
        Header User-Agent ^masscan DenyAccess
        Header User-Agent ^Java DenyAccess
        Header User-Agent ^Nutch DenyAccess
        Header User-Agent ^Who.is DenyAccess
        Header User-Agent ^immoral DenyAccess
        Header User-Agent ^crawler DenyAccess
        Header User-Agent ^NetShelter DenyAccess
        Header User-Agent ^Application DenyAccess
        Header User-Agent ^Validator.nu/LV DenyAccess
        Header * ^ssdp DenyAccess
        Header User-Agent ^Arachni DenyAccess
        Header User-Agent ^Spider-Pig DenyAccess
        Header User-Agent ^tinfoilsecurity DenyAccess
        Header User-Agent ^@ DenyAccess
        Header User-Agent ^shellshock-scan DenyAccess
        Header User-Agent ^Vega DenyAccess
        Header * ^\(\)\s*\{ DenyAccess
        Header * ^uname DenyAccess
        Header * ^whoami DenyAccess
        Header User-Agent ^friendly-scanner DenyAccess
        Header * ^mxmail.netease.com DenyAccess
        Header * ^muieblackcat DenyAccess
        Header User-Agent ^BOT\sfor\sJCE DenyAccess
}

UrlToolkit {
	ToolkitID = findindexfile
	Match ^([^?]*)/(\?.*)?$ Rewrite $1/index.php$2 Continue
	RequestURI isfile Return
	Match ^([^?]*)/index\.php(\?.*)?$ Rewrite $1/index.html$2 Continue
	RequestURI isfile Return
	Match ^([^?]*)/index\.html(\?.*)?$ Rewrite $1/index.shtml$2 Continue
	RequestURI isfile Return
	Match ^([^?]*)/index\.shtml(\?.*)?$ Rewrite $1/index.htm$2 Continue
	RequestURI isfile Return
	Match ^([^?]*)/index\.htm(\?.*)?$ Rewrite $1/index.pl$2 Continue
	RequestURI isfile Return
	Match ^([^?]*)/index\.pl(\?.*)?$ Rewrite $1/index.py$2 Continue
	RequestURI isfile Return
	Match ^([^?]*)/index\.py(\?.*)?$ Rewrite $1/index.cgi$2 Continue
	RequestURI isfile Return
	Match ^([^?]*)/index\.cgi(\?.*)?$ Rewrite $1/index.rb$2 Continue
	RequestURI isfile Return
	Match ^([^?]*)/index\.rb(\?.*)?$ Rewrite $1/default.htm$2 Continue
	RequestURI isfile Return
	Match ^([^?]*)/default\.htm(\?.*)?$ Rewrite $1/Default.aspx$2 Continue
	RequestURI isfile Return
	Match ^([^?]*)/Default\.aspx(\?.*)?$ Rewrite $1/Default.asp$2 Continue
	RequestURI isfile Return
	Match ^([^?]*)/Default\.asp(\?.*)?$ Rewrite $1/$2 Continue
}

# DEFAULT WEBSITE
Hostname = 98.139.183.24
WebsiteRoot = /var/www/hiawatha
StartFile = index.html
AccessLogfile = /var/log/hiawatha/access.log
ErrorLogfile = /var/log/hiawatha/error.log
ReverseProxy ^/.* http://www.example.com:80/


# VIRTUAL HOSTS
VirtualHost {
	Hostname = www.DOMAIN, DOMAIN
   	WebsiteRoot = /var/www/strut
   	StartFile = index.php
   	AccessLogfile = /var/log/hiawatha/access_DOMAIN.log
   	ErrorLogfile = /var/log/hiawatha/error_DOMAIN.log
   	TimeForCGI = 1000
   	UseFastCGI = PHP5
   	DenyBody = ^.*%3Cscript.*%3C%2Fscript%3E.*$
   	DenyBody = ^.*%3Cmeta.*%2F%3E.*$
   	DenyBody = ^.*%3Ciframe.*%2F%3E.*$
   	DenyBody = ^.*%00.*$
   	PreventCSRF = yes
   	PreventSQLi = yes
   	PreventXSS = yes
        UseToolkit = findindexfile
	Alias = /phpinfo:/var/www/phpinfo
}
